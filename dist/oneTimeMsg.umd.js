(function(c,g){typeof exports=="object"&&typeof module<"u"?g(exports):typeof define=="function"&&define.amd?define(["exports"],g):(c=typeof globalThis<"u"?globalThis:c||self,g(c.MyLib={}))})(this,(function(c){"use strict";const g=function(m){const f=new Date;console.log(m||"unknown-script","ran",f.getHours(),":",f.getMinutes());const d=function(a){return new Promise((e,s)=>{a?e(browser.tabs.query(a)):s(new Error("tab querying failed"))})};async function l(a){const{message:e,errorCb:s,successCb:i}=a;try{const t=await browser.runtime.sendMessage(e);if(!t.status)throw new Error(t.message??"browser.runtime.sendMessage error");i(t)}catch(t){s({status:!1,message:t.message??"message to background script failed"})}}return{messageBackgroundScript:l,messagePopupScript:l,messageContentScript:async function(a){const{tabQueryProps:e,message:s,successCb:i,errorCb:t}=a;try{if(!e)throw new Error("tabQueryProps is undefined");const n=await d(e),o=n.length>0?n[0].id:null;if(!o)throw new Error("no tabs found");const r=await browser.tabs.sendMessage(o,s);i({status:!0,data:r})}catch(n){t({status:!1,message:n.message??"unknown tab querying error"})}},onMessageSync:function(a){const{validateMessage:e,validateSender:s,onSyncCb:i}=a,t=function(n,o,r){if(e&&!e(n))return r({status:!1,message:"validateMessage failed"}),!1;if(s&&!s(o))return r({status:!1,message:"validateSender failed"}),!1;const u=i(n,o);return r({status:!0,data:u,message:"onMessageSync success"}),!1};browser.runtime.onMessage.addListener(t)},onMessageAsync:function(a){const{validateMessage:e,validateSender:s,onAsyncCb:i}=a,t=function(n,o,r){return e&&!e(n)?(r?.({status:!1,message:"validateMessage failed"}),!1):s&&!s(o)?(r?.({status:!1,message:"validateSender failed"}),!1):((async function(){try{const u=await i?.(n,o);if(!u)throw Error;r?.({status:!0,data:u,message:"onMessageAsync success"})}catch(u){r?.({status:!1,message:u?.message??"onMessageAsync returned an error"})}})(),!0)};browser.runtime.onMessage.addListener(t)},getTabsFn:d}};c.oneTimeMsgFactory=g,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})}));
